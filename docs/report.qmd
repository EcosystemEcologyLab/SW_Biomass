---
title: "AZ Carbon Stores"
format: 
  html:
    toc: true
editor: visual
---

## Data

So far the data products include:

| Product                               | Downloaded (including CA) | Wrangled |
|---------------------------------------|---------------------------|----------|
| Xu AGBC                               | ✅                        | ✅       |
| Liu AGBC                              | ✅                        | ✅       |
| LT-GNN AGB                            | ✅                        | ✅       |
| Chopping AGB                          | ✅                        | ✅       |
| Menlove AGB                           | ✅                        | ✅       |
| ESA CCI/GlobBiomass AGB v004          | ✅                        | ✅       |
| GEDI L4B AGB v2.1                     | ✅                        | ✅       |
| Rangeland Analysis Platform (RAP) AGB | ✅                        | ✅       |

RAP is a model product only for rangelands (i.e. annual or perennial grasses and forbs) and is not included in comparisons right now.

## Figures

@sec-agb shows all of the data products transformed to the same extent and resolution.
@sec-median shows the median AGB across all products.
@sec-sd shows spatial distribution of uncertainty.
@sec-data-distribution shows the differences in AGB distribution among data products.

Observations:

-   The Liu product doesn't include *any* zeros

-   The Xu product has the largest area of low but not zero values

-   The ESA product has the greatest total range of values

-   The ESA product has some very high AGB pixels surrounded by very low (maybe zero?) AGB pixels—this may be an artifact of some kind?

### AGB {#sec-agb}

#### Arizona

![Maps of AGB for each data product in Arizona.](fig/map_agb_AZ.png){#fig-map_agb_az fig-align="center"}

<!-- {{< downloadthis fig/map_agb_AZ.png label="Download .png" >}} -->

#### California

![Maps of AGB for each data product in California.](fig/map_agb_CA.png){#fig-map_agb_ca fig-align="center"}

<!-- {{< downloadthis fig/map_agb_CA.png label="Download .png" >}} -->

#### SRER

![Maps of AGB for each data product in SRER](fig/map_agb_SRER.png){#fig-map_agb_srer fig-align="center"}

<!-- {{< downloadthis fig/map_agb_SRER.png label="Download .png" >}} -->

#### Pima County

![Maps of AGB for each data product in Pima County](fig/map_agb_PimaCounty.png){#fig-map_agb_pima fig-align="center"}

<!-- {{< downloadthis fig/map_agb_PimaCounty.png label="Download .png" >}} -->

### Median {#sec-median}

#### Arizona

![Median AGB across data products](fig/map_median_AZ.png){#fig-map_median_az fig-align="center"}

<!-- {{< downloadthis fig/map_median_AZ.png label="Download .png" >}} -->

#### California

![Median AGB across data products](fig/map_median_CA.png){#fig-map_median_ca fig-align="center"}

<!-- {{< downloadthis fig/map_median_CA.png label="Download .png" >}} -->

#### SRER

![Median AGB across data products](fig/map_median_SRER.png){#fig-map_median_srer fig-align="center"}

<!-- {{< downloadthis fig/map_median_SRER.png label="Download .png" >}} -->

#### Pima County

![Median AGB across data products](fig/map_median_PimaCounty.png){#fig-map_median_pima fig-align="center"}

<!-- {{< downloadthis fig/map_median_PimaCounty.png label="Download .png" >}} -->

### Standard Deviation {#sec-sd}

#### Arizona

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple. Note: the color gradient is on a log scale.](fig/map_sd_AZ.png){#fig-map_sd_az fig-align="center"}

<!-- {{< downloadthis fig/map_sd_AZ.png label="Download .png" >}} -->

#### California

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple. Note: the color gradient is on a log scale.](fig/map_sd_CA.png){#fig-map_sd_ca fig-align="center"}

<!-- {{< downloadthis fig/map_sd_CA.png label="Download .png" >}} -->

#### SRER

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple. Note: the color gradient is on a log scale.](fig/map_sd_SRER.png){#fig-map_sd_srer fig-align="center"}

<!-- {{< downloadthis fig/map_sd_SRER.png label="Download .png" >}} -->

#### Pima County

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple. Note: the color gradient is on a log scale.](fig/map_sd_PimaCounty.png){#fig-map_sd_pima fig-align="center"}

<!-- {{< downloadthis fig/map_sd_PimaCounty.png label="Download .png" >}} -->

### Data distribution {#sec-data-distribution}

Density ridge plots are a good compact way to visualize this.

::: callout-note
It ended up being relatively easy to just do my own kernel density estimation, so now the ridgelines are correctly truncated at min and max without having to add a point to show the range of values.
:::

#### Arizona

![Distribution of Arizona AGB values by data product.](fig/agb_density_az.png){#fig-ridge_az fig-align="center"}

<!-- {{< downloadthis fig/agb_density_az.png label="Download .png" >}} -->

#### California

![Distribution of California AGB values by data product.](fig/agb_density_ca.png){#fig-ridge_ca fig-align="center"}

#### SRER

![Distribution of SRER AGB values by data product.](fig/agb_density_srer.png){#fig-ridge_srer fig-align="center"}

#### Pima County

![Distribution of Pima County AGB values by data product.](fig/agb_density_pima.png){fig-align="center"}

### Scatter plots

These plots are intended to compare each data product with the "gold standard" ESA product.
These use a random sample of 200,000 pixels from each product.
While it is technically possible to make these plots using the entire dataset, the result will be a dark black blob for all of them.
200,000 points is only \~0.5% (total non-NA pixels = 35,342,827).

::: {layout-ncol="3"}
![](fig/scatter_chopping_et_al.png){width="2in"}

![](fig/scatter_gedi_l_4_b.png){width="2in"}

![](fig/scatter_liu_et_al.png){width="2in"}

![](fig/scatter_lt_gnn.png){width="2in"}

![](fig/scatter_menlove_healey.png){width="2in"}

![](fig/scatter_xu_et_al.png){width="2in"}
:::

<!-- {{< downloadthis fig/scatter.zip label="Download .zip" >}} -->

<!-- ### Point density plots -->

<!-- A point density plot is great for when a scatter plot contains many over-plotted points. -->

<!-- These plots use the [`ggpointdensity`](https://github.com/LKremer/ggpointdensity) package which extends `ggplot2`. -->

<!-- Color represents density of data under each point. -->

<!-- Because of the abundance of zeros, if the full dataset is plotted without any tansformation of the color scale, there is always a single bright spot in the lower left corner, but I think a log scale makes enough sense to use. -->

<!-- ![](fig/test_KernSmooth_log.png){width="524"} -->

<!-- This is an example of what it could look like, but there are technical barriers to getting it to work: <https://github.com/cct-datascience/SW_Biomass/issues/18>. -->

<!-- For now, maybe the scatter plots are good enough? -->

## Summary Statistics

```{r}
#| label: tbl-summary
#| tbl-cap: "Summary statistics calculated on median AGB across data products for each geographical subset."
#| echo: false
library(gt)
targets::tar_read(summary_stats, store = here::here("_targets")) |> 
  gt::gt() |> 
  fmt_number() |> 
  opt_stylize() |> 
  tab_style(cell_text(transform = "capitalize"), cells_column_labels())
```
