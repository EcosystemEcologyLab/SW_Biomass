---
title: "AZ Carbon Stores"
format: 
  html:
    toc: true
editor: visual
---

## Roadmap

-   ~~Get workflow working with AZ~~

-   Download additional data for some data products to cover CA

-   Get additional shapfiles (CA and Pima County)

-   Extend workflow to plot maps and density ridge plot for AZ, CA, SRER, and Pima county

## Data

So far the data products include:

| Product                               | Downloaded | Wrangled |
|---------------------------------------|------------|----------|
| Xu AGBC                               | ✅         | ✅       |
| Liu AGBC                              | ✅         | ✅       |
| LT-GNN AGB                            | ✅         | ✅       |
| Chopping AGB                          | ✅         | ✅       |
| Menlove AGB                           | ✅         | ✅       |
| ESA CCI/GlobBiomass AGB v004          | ✅         | ✅       |
| GEDI L4B AGB v2.1                     | ✅         | ✅       |
| Rangeland Analysis Platform (RAP) AGB | ✅         | ✅       |

RAP is a model product only for rangelands (i.e. annual or perennial grasses and forbs) and is not included in comparisons right now.

## Figures

@fig-agbmap shows all of the data products transformed to the same extent and resolution.
In an attempt to get a spatial sense of where these datasets agree/disagree the most, @fig-sdmap shows the standard deviation across the pixels.
@fig-violin shows the distribution of (a sample of) AGB values for each data product.

Observations:

-   The Liu product doesn't include *any* zeros

-   The Xu product has the largest area of low but not zero values

-   The ESA product has the greatest total range of values

-   The ESA product has some very high AGB pixels surrounded by very low (maybe zero?) AGB pixels—this may be an artifact of some kind?

### Maps

![Maps of aboveground biomass for each data product in Arizona.](fig/map_agb.png){#fig-map_agb fig-align="center"}

{{< downloadthis fig/map_agb.png label="Download .png" >}}

<!--# TODO: add download button for .eps file as well so Dave can open in Adobe easily -->

#### Median

![Median AGB across data products](fig/map_median.png){#fig-map_median fig-align="center"}

{{< downloadthis fig/map_median.png label="Download .png" >}}

#### Standard Deviation

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple. Note: the color gradient is on a log scale.](fig/map_sd.png){#fig-map_sd fig-align="center"}

{{< downloadthis fig/map_sd.png label="Download .png" >}}

### Data distribution

Density ridge plots are a good compact way to visualize this.

::: callout-note
It ended up being relatively easy to just do my own kernel density estimation, so now the ridgelines are correctly truncated at min and max without having to add a point to show the range of values.
:::

![Distribution of AGB values by data product. Axis is "broken" omitting values between 20 and 100 for AGB.](fig/agb_ridge.png){#fig-ridge1 fig-align="center" width="4.99in"}

{{< downloadthis fig/agb_ridge.png label="Download .png" >}}

![Distribution of AGB values by data product. Axis is "broken" omitting values between 20 and 100 for AGB. Kernel density estimation is performed separately for each panel.](fig/agb_ridge2.png){#fig-ridge2 fig-align="center" width="5in"}

{{< downloadthis fig/agb_ridge2.png label="Download .png" >}}

### Scatter plots

These plots are intended to compare each data product with the "gold standard" ESA product.
These use a random sample of 200,000 pixels from each product.
While it is technically possible to make these plots using the entire dataset, the result will be a dark black blob for all of them.
200,000 points is only \~0.5% (total non-NA pixels = 35,342,827).

::: {layout-ncol="3"}
![](fig/scatter_chopping_et_al.png){width="2in"}

![](fig/scatter_gedi_l_4_b.png){width="2in"}

![](fig/scatter_liu_et_al.png){width="2in"}

![](fig/scatter_lt_gnn.png){width="2in"}

![](fig/scatter_menlove_healey.png){width="2in"}

![](fig/scatter_xu_et_al.png){width="2in"}
:::

{{< downloadthis fig/scatter.zip label="Download .zip" >}}

### Point density plots

A point density plot is great for when a scatter plot contains many over-plotted points.
These plots use the [`ggpointdensity`](https://github.com/LKremer/ggpointdensity) package which extends `ggplot2`.
Color represents density of data under each point.
Because of the abundance of zeros, if the full dataset is plotted without any tansformation of the color scale, there is always a single bright spot in the lower left corner, but I think a log scale makes enough sense to use.

![](fig/test_KernSmooth_log.png){width="524"}

This is an example of what it could look like, but there are technical barriers to getting it to work: <https://github.com/cct-datascience/SW_Biomass/issues/18>.
For now, maybe the scatter plots are good enough?
