---
title: "AZ Carbon Stores"
format: 
  html:
    toc: true
editor: visual
---

## Data

So far the data products include:

| Product                               | Downloaded | Wrangled |
|---------------------------------------|------------|----------|
| Xu AGBC                               | ✅         | ✅       |
| Liu AGBC                              | ✅         | ✅       |
| LT-GNN AGB                            | ✅         | ✅       |
| Chopping AGB                          | ✅         | ✅       |
| Menlove AGB                           | ✅         | ✅       |
| ESA CCI/GlobBiomass AGB v004          | ✅         | ✅       |
| GEDI L4B AGB v2.1                     | ✅         | ✅       |
| Rangeland Analysis Platform (RAP) AGB | ✅         | ✅       |

RAP is a model product only for rangelands (i.e. annual or perennial grasses and forbs) and is not included in comparisons right now.

## Figures

@fig-agbmap shows all of the data products transformed to the same extent and resolution.
In an attempt to get a spatial sense of where these datasets agree/disagree the most, @fig-sdmap shows the standard deviation across the pixels.
@fig-violin shows the distribution of (a sample of) AGB values for each data product.

Observations:

-   The Liu product doesn't include *any* zeros

-   The Xu product has the largest area of low but not zero values

-   The ESA product has the greatest total range of values

-   The ESA product has some very high AGB pixels surrounded by very low (maybe zero?) AGB pixels—this may be an artifact of some kind?

### Maps

![Maps of aboveground biomass for each data product in Arizona.](fig/agb_map.png){#fig-agbmap}

{{< downloadthis fig/agb_map.png label="Download .png" >}}

<!--# TODO: add download button for .eps file as well so Dave can open in Adobe easily -->

#### Standard Deviation

![Map of standard deviation of each raster pixel showing areas with the highest variation among data products in yellow and areas with the least variation in dark purple.](fig/sd_map.png){#fig-sdmap fig-align="center" width="2.85in"}

{{< downloadthis fig/sd_map.png label="Download .png" >}}

The map doesn't look like much since there are a lot of low values for SD with relatively fewer extreme values.
Here are some alternatives that make the areas of high uncertainty "pop" (using a different color palette doesn't really help—viridis is still the best IMO)

1.  log-transform the color scale

    ![](fig/map_log1p.png)

    (Ignore the color bar—if we went with this version, we'd pick better breaks than the default)

2.  "squish" extreme values

    ![](fig/map_squish.png)

    Could set the upper limit even lower to get more pixels into that upper yellow range.

#### SRER inset/outset

Adding an inset map of SRER is just too cramped to look good at such a small size, I think.

![](fig/inset_attempt.png)

But what about a two panel figure with everything "slimmed down" as much as possible?

![](fig/twopanel.png){width="3.78in"}

(I drew the red "zoom" lines by hand—they are totally optional)

### Data distribution

Density ridge plots are a good compact way to visualize this.

![](fig/agb_ridge.png){fig-align="center" width="4in"}

{{< downloadthis fig/agb_ridge.png label="Download .png" >}}

The long tail makes it somewhat difficult to see differences.
Here are a couple of alternatives with "broken" axes.
In both, I've marked the actual max AGB calculated from the full data set with a point.

![AGB 0-30 and 30-max where the density is calculated separately for each panel.](fig/ridge_opt1.png){#fig-ridgeopt1}

![AGB 0-30 and 100-max with density calculated on the full (sample) dataset.](fig/ridge_opt2.png){#fig-ridgeopt2}

In @fig-ridgeopt1 the differences in the tails are emphasized since the relative density is calculated separately for the tails.
In order to get the y-axes to line up, however, we squish the heads a bit.
In @fig-ridgeopt2 the tail panel just serves to show differences in the range of the data and intermediate AGB values (30-100) are left out.

### Scatter plots

These plots are intended to compare each data product with the "gold standard" ESA product.
These use a random sample of 200,000 pixels from each product.
While it is technically possible to make these plots using the entire dataset, the result will be a dark black blob for all of them.
200,000 points is only \~0.5% (total non-NA pixels = 35,342,827).

::: {layout-ncol="3"}
![](fig/scatter_chopping_et_al.png){width="2in"}

![](fig/scatter_gedi_l_4_b.png){width="2in"}

![](fig/scatter_liu_et_al.png){width="2in"}

![](fig/scatter_lt_gnn.png){width="2in"}

![](fig/scatter_menlove_healey.png){width="2in"}

![](fig/scatter_xu_et_al.png){width="2in"}
:::

{{< downloadthis fig/scatter.zip label="Download .zip" >}}

### Point density plots

A point density plot is great for when a scatter plot contains many over-plotted points.
These plots use the [`ggpointdensity`](https://github.com/LKremer/ggpointdensity) package which extends `ggplot2`.
Color represents density of data under each point.
Because of the abundance of zeros, if the full dataset is plotted without any tansformation of the color scale, there is always a single bright spot in the lower left corner, but I think a log scale makes enough sense to use.

![](fig/test_KernSmooth_log.png){width="524"}

This is an example of what it could look like, but there are technical barriers to getting it to work: <https://github.com/cct-datascience/SW_Biomass/issues/18>.
For now, maybe the scatter plots are good enough?
